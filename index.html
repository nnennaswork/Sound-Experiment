<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Music Logging Test</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  #status { margin-bottom: 20px; font-weight: bold; }
  #skipButton { padding: 10px 16px; background: #444; color: white; border: none; font-size: 16px; cursor: pointer; }
  #skipButton:hover { background: #000; }
</style>
</head>
<body>

<h2>Music Logging Test</h2>
<div id="status">Loading...</div>

<audio id="player" controls>
  <source id="audioSource" src="CHAKRa.mp3" type="audio/mpeg">
</audio>

<button id="skipButton">Skip Song</button>

<script>
// --------------------
// CONFIG
// --------------------
const TEST_MODE = true;   // set true for testing
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzXRnyjpnUYJZC5mYs5t0yCmDtlN3E_NXD1P-qYK_QIOag_cfCwAK9WvaZFI_PRL3IX/exec"; // Replace with your deployed Apps Script URL

// --------------------
// VARIABLES
// --------------------
let participantID = "P" + Math.floor(Math.random()*1000000);
let songName = "Test Song";

const player = document.getElementById("player");
const statusDiv = document.getElementById("status");
const skipButton = document.getElementById("skipButton");

// --------------------
// LOG FUNCTION
// --------------------
function logEvent(type, time){
  fetch(SCRIPT_URL, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({
      type: "event",
      participant: participantID,
      group: "N/A",
      song: songName,
      event: type,
      time: time,
      testMode: TEST_MODE,
      userAgent: navigator.userAgent
    })
  }).catch(err => console.error("Logging failed:", err));
}

// --------------------
// PLAYER EVENTS
// --------------------
player.onplay    = () => logEvent("play", player.currentTime);
player.onpause   = () => logEvent("pause", player.currentTime);
player.onseeking = () => logEvent("seek", player.currentTime);
player.onended   = () => logEvent("complete", player.duration);

// --------------------
// SKIP BUTTON
// --------------------
skipButton.onclick = () => {
  logEvent("skip", player.currentTime);
  statusDiv.textContent = "Skipped!";
  player.currentTime = player.duration; // effectively ends playback
};

// --------------------
// INITIALIZE
// --------------------
statusDiv.textContent = "Ready to play!";
</script>

</body>
</html>
